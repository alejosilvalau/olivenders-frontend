<div class="container my-4">
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4"
  >
    <h2 class="mb-3 mb-md-0">ORDERS MANAGEMENT</h2>
    <app-searcher
      [data]="orders"
      [filterAttributes]="[
        'payment_provider',
        'shipping_address',
        'tracking_id',
        'status',
        'created_at',
        'id'
      ]"
      (filteredData)="onSearch($event)"
      (searchTermChange)="searchTerm = $event"
      class="searcher"
    ></app-searcher>
  </div>
  <app-alert></app-alert>
  <app-data-table
    [columns]="[
      { key: 'id', label: 'ID' },
      { key: 'payment_provider', format: DataTableFormat.TitleCase, label: 'Payment Provider' },
      { key: 'shipping_address', format: DataTableFormat.TitleCase, label: 'Shipping Address' },
      { key: 'wand', subKey: 'total_price', format: DataTableFormat.Currency, label: 'Price' },
      { key: 'wand', subKey: 'profit', format: DataTableFormat.Currency, label: 'Profit' },
      { key: 'tracking_id', label: 'Tracking ID' },
      { key: 'status', format: DataTableFormat.TitleCase, label: 'status' },
      { key: 'wizard', subKey: 'username', format: DataTableFormat.TitleCase, label: 'Username', },
      { key: 'wand', subKey: 'name', format: DataTableFormat.TitleCase, label: 'Name' }
    ]"
    [data]="filteredOrders"
    [emptyMessage]="'There are no orders available'"
    [editModalTarget]="'#editOrder'"
    [removeModalTarget]="'#removeOrder'"
    (selectedEntity)="onOrderSelected($event)"
  >
  </app-data-table>
    <app-pagination
    [totalRecords]="totalOrders"
    [currentPage]="currentPage"
    [pageSize]="pageSize"
    (pageChange)="onPageChange($event)"
    (pageSizeChange)="onPageSizeChange($event)">
  </app-pagination>
  <app-modal
    [config]="{
      id: 'editOrder',
      title: 'Edit Order',
      submitButtonText: 'Save Changes',
      cancelButtonText: 'Cancel'
    }"
    (onSubmit)="editOrder()"
    (onCancel)="orderForm.reset()"
  >
    <ng-template #modalContent>
      <form [formGroup]="orderForm">
        <div class="col-md-12" *ngIf="!isOrderDispatched(selectedOrder!)">
          <label for="shipping_address">Shipping Address</label>
          <input type="text" formControlName="shipping_address" id="shipping_address" name="shipping_address" class="form-control" required />
          <label for="dispatchOrderButton">More Options</label>
          <button
          id="dispatchOrderButton"
          type="button"
          class="btn w-100 modal-button"
          (click)="dispatchOrder()"
          data-bs-dismiss="modal"
          [disabled]="!selectedOrder"
        >
          Dispatch Order
        </button>
        </div>
        <div class="col-md-12" *ngIf="isOrderDispatched(selectedOrder!)">
          <p>Order <strong>#{{ selectedOrder?.id }}</strong> is already dispatched. There is nothing is left to do.</p>
          <p>Please, press any button to return.</p>
        </div>
      </form>
    </ng-template>
  </app-modal>
  <app-modal
    [config]="{
      id: 'removeOrder',
      title: 'Remove Order',
      submitButtonText: 'Confirm Delete',
      cancelButtonText: 'Cancel'
    }"
    (onSubmit)="removeOrder()"
    (onCancel)="orderForm.reset()"
  >
    <ng-template #modalContent>
      <div class="col-md-12">
        <p>Are you sure that you want to remove the order <strong>#{{ selectedOrder?.id }}</strong> ?</p>
      </div>
    </ng-template>
  </app-modal>
</div>
